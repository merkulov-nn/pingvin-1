# pingvin-1
Задание

1. Попастþ в систему без паролā несколþкими способами
2. Установитþ систему с LVM, после чего переименоватþ VG
3. Добавитþ модулþ в initrd

Попасть в систему без пароля несколькими способами
Длā получениā доступа необходимо открýтþ GUI VirtualBox (или другой системý
виртуализации), запуститþ виртуалþнуĀ машину и при вýборе āдра длā загрузки нажатþ e - в
данном контексте edit. Попадаем в окно где мý можем изменитþ параметрý загрузки:

Попасть в систему без пароля несколькими способами

Способ 1. init=/bin/sh
● В конце строки начинаĀщейсā с linux16 добавлāем init=/bin/sh и нажимаем сtrl-x длā
загрузки в систему
● В целом на ÿтом все, Вý попали в систему. Но естþ один нĀанс. Рутоваā файловаā
система при ÿтом монтируетсā в режиме Read-Only. Если вý хотите перемонтироватþ ее в
режим Read-Write можно восполþзоватþсā командой:
[root@otuslinux ~]# mount -o remount,rw /

● После чего можно убедитþсā записав даннýе в лĀбой файл или прочитав вýвод
командý:
[root@otuslinux ~]# mount | grep root

Попасть в систему без пароля несколькими способами

Способ 2. rd.break
● В конце строки начинаĀщейсā с linux16 добавлāем rd.break и нажимаем сtrl-x длā
загрузки в систему
● Попадаем в emergency mode. Наша корневаā файловаā система смонтирована (опāтþ же
в режиме Read-Only, но мý не в ней. Далее будет пример как попастþ в нее и поменāтþ
паролþ администратора:
[root@otuslinux ~]# mount -o remount,rw /sysroot
[root@otuslinux ~]# chroot /sysroot
[root@otuslinux ~]# passwd root
[root@otuslinux ~]# touch /.autorelabel
● После чего можно перезагружатþсā и заходитþ в систему с новýм паролем. Полезно
когда вý потерāли или вообще не имели паролþ администратор.

Попасть в систему без пароля несколькими способами

Способ 3. rw init=/sysroot/bin/sh
● В строке начинаĀщейсā с linux16 заменāем ro на rw init=/sysroot/bin/sh и нажимаем сtrl-x
длā загрузки в систему
● В целом то же самое что и в прошлом примере, но файловаā система сразу
смонтирована в режим Read-Write
● В прошлýх примерах тоже можно заменитþ ro на rw

Установить систему с LVM, после чего переименовать VG

● Первýм делом посмотрим текущее состоāние системý:
[root@otuslinux ~]# vgs
VG #PV #LV #SN Attr VSize VFree
VolGroup00 1 2 0 wz--n- <38.97g 0
● Нас интересует втораā строка с именем Volume Group
● Приступим к переименованиĀ:
[root@otuslinux ~]# vgrename VolGroup00 OtusRoot
Volume group "VolGroup00" successfully renamed to "OtusRoot"

Установить систему с LVM, после чего переименовать VG

● Далее правим /etc/fstab, /etc/default/grub, /boot/grub2/grub.cfg. Везде заменāем старое
название на новое. По ссýлкам можно увидетþ примерý получившихсā файлов.
● Пересоздаем initrd image, чтобý он знал новое название Volume Group
[root@otuslinux ~]# mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)
...
*** Creating image file done ***
*** Creating initramfs image file '/boot/initramfs-3.10.0-862.2.3.el7.x86_64.img' done ***
● После чего можем перезагружатþсā и если все сделано правилþно успешно грузимсā с
новýм именем Volume Group и проверāем:
[root@otuslinux ~]# vgs
VG #PV #LV #SN Attr VSize VFree
OtusRoot 1 2 0 wz--n- <38.97g 0
● При желании можно так же заменитþ название Logical Volume

Добавить модуль в initrd

Скриптý модулей хранāтсā в каталоге /usr/lib/dracut/modules.d/. Длā того чтобý
добавитþ свой модулþ создаем там папку с именем 01test:
[root@otuslinux ~]# mkdir /usr/lib/dracut/modules.d/01test
В нее поместим два скрипта:
1. module-setup.sh - которýй устанавливает модулþ и вýзýвает скрипт test.sh
2. test.sh - собственно сам вýзýваемýй скрипт, в нём у нас рисуетсā пингвинчик
Примерý файлов по ссýлкам.

Добавить модуль в initrd

● Пересобираем образ initrd
[root@otuslinux ~]# mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)
или
[root@otuslinux ~]# dracut -f -v
● Можно проверитþ/посмотретþ какие модули загруженý в образ:
[root@otuslinux ~]# lsinitrd -m /boot/initramfs-$(uname -r).img | grep test
test
● После чего можно пойти двумā путāми длā проверки:
○ Перезагрузитþсā и руками вýклĀчитþ опции rghb и quiet и увидетþ вýвод
○ Либо отредактироватþ grub.cfg убрав ÿти опции
● В итоге при загрузке будет пауза на 10 секунд и вý увидите пингвина в вýводе
терминала
